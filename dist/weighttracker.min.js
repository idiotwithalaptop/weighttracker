/*! weighttracker 13-10-2014 */
function AzureWeightService(){tableSvc.createTableIfNotExists("weight",function(a){})}var express=require("express"),path=require("path"),favicon=require("serve-favicon"),logger=require("morgan"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),cookieSession=require("cookie-session"),csrf=require("csurf"),routes=require("./routes/index"),app=express();app.set("views",path.join(__dirname,"views")),app.set("view engine","ejs"),app.use(logger("dev")),app.use(bodyParser.json()),app.use(cookieParser()),app.use(cookieSession({keys:["iwal1984","kyh@$8615"]})),app.use(csrf()),app.use(express.static(path.join(__dirname,"public"))),app.use("/",routes),app.use(function(a,b,c){var d=new Error("Not Found");d.status=404,c(d)}),"development"===app.get("env")&&app.use(function(a,b,c){c.status(a.status||500),c.render("error",{message:a.message,error:a})}),app.use(function(a,b,c){c.status(a.status||500),c.render("error",{message:a.message,error:a})}),module.exports=app,module.exports={google:{clientId:"456375033128-8in1opc1cju7adtqnh6vlgq6cpdoi3pc.apps.googleusercontent.com",clientSecret:"yCEAezYQlJDrifRhG4L6aIs3",redirectUrl:"http://localhost:3000/oauth2callback"}};var azure=require("azure-storage"),WeighIn=require("../../domain/weighin"),tableSvc=azure.createTableService(),exports=module.exports;AzureWeightService.prototype.insertWeighIn=function(a,b){var c=azure.TableUtilities.entityGenerator,d={PartitionKey:c.String(a),RowKey:c.String((new Date).toJSON()),result:c.Double(b.result),date:c.DateTime(b.date)};tableSvc.insertEntity("weight",d,function(a){})},AzureWeightService.prototype.getWeighInsForUser=function(a,b){var c=(new azure.TableQuery).select(["result","date"]).where("PartitionKey eq ?",a);tableSvc.queryEntities("weight",c,null,function(a,c){if(a)b({error:!0,msg:"Error querying"});else{for(var d=[],e=0;e<c.entries.length;e++){var f=c.entries[e];d.push({result:f.result._,date:f.date._})}b({error:!1,result:d})}})},exports.createWeighInService=function(){return new AzureWeightService};var date,result,WeighIn=function(a,b){date=b,result=a};WeighIn.prototype={date:date,result:result},module.exports=WeighIn;var express=require("express"),router=express.Router(),data=require("../../data/azure/weight").createWeighInService(),WeighIn=require("../../domain/weighin");router.get("/",function(a,b){b.json({message:"no direct services available"})}),router.get("/:userId",function(a,b){data.getWeighInsForUser(a.params.userId,function(c){b.json({message:"Weigh Ins for "+a.params.userId,data:c})})}),router.put("/:userId",function(a,b){var c=a.body;data.insertWeighIn(a.params.userId,c),b.json({message:"Weigh-In Captured"})}),module.exports=router;var express=require("express"),router=express.Router(),google=require("googleapis"),plus=google.plus("v1"),OAuth2=google.auth.OAuth2,conf=require("../conf");router.get("/",function(a,b){b.json({result:"wacca"})}),router.post("/login",function(a,b){var c=new OAuth2(conf.google.clientId,conf.google.clientSecret,conf.google.redirectUrl);c.getToken(a.body.authCode,function(a,d){a||(c.setCredentials(d),plus.people.get({userId:"me",auth:c},function(a,c){a||b.json({profile:c})}))})}),module.exports=router;var express=require("express"),router=express.Router(),users=require("./users"),weighIns=require("./api/weighIn"),auth=require("./auth");router.use("/users",users),router.use("/api/weighIns",weighIns),router.use("/auth",auth),router.get("/",function(a,b){b.render("index",{title:"Express",csrfToken:a.csrfToken()})}),module.exports=router;var express=require("express"),router=express.Router();router.get("/",function(a,b){b.send("respond with a resource")}),module.exports=router;